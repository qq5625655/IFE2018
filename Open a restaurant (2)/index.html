<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>开一家餐厅</title>

</head>

<body>
    <button id="seat">顾客入座</button>
    <button id="leave">顾客离开</button>
    <script>
        'use strict'
        //ES5

        //餐厅
        function Restaurant(object) {
            this.cash = object.cash;
            this.seats = object.seats;
            this.staff = object.staff;
        }
        Restaurant.prototype = {
            constructor: Restaurant,
            hire: function (value) {
                this.staff.push(value);
            },
            fire: function (value) {
                let index = this.staff.indexOf(value);
                this.staff.splice(index, 1);
            }
        }
        //职员
        function Clerk(id, name, salary) {
            this.id = id;
            this.name = name;
            this.salary = salary;
        }
        Clerk.prototype.finish = function (type) {
            console.log('完成工作了！');
        }

        //服务单例模式
        let singletonWaiter = (function () {
            let instance = null;
            //服务类
            function Waiter(id, name, salary) {
                Clerk.apply(this, arguments); //继承属性

            }
            //继承方法
            extend(Waiter, Clerk);
            //如果参数是个数组，则记录客人点菜，如果参数不是数组则是上菜行为
            Waiter.prototype.work = function (value) {
                if (Array.isArray(value)) {
                    console.log('客人点菜了，我要快给大厨报菜名！');
                    return value;
                } else {
                    console.log('您要的' + value + '好了，您慢用！');
                }
            }
            return {
                getInstance: function (id, name, salary) {
                    if (instance === null) {
                        instance = new Waiter(id, name, salary);
                    }
                    return instance;
                }
            }
        })();
        //厨师单例模式
        let singletonCook = (function () {
            let instance = null;

            function Cook(id, name, salary) {
                Clerk.apply(this, arguments); //继承属性

            }
            extend(Cook, Clerk);
            Cook.prototype.work = function (array) {
                let string = '';
                console.log('厨师开始做菜了！');
                return string;

            }
            return {
                getInstance: function (id, name, salary) {
                    if (instance === null) {
                        instance = new Cook(id, name, salary);
                    }
                    return instance;
                }
            }
        })();

        //顾客类
        function Customer(name) {
            this.name = name;
        }
        //吃
        Customer.prototype.eat = function () {
            console.log('吃吃吃吃！！');
            console.log('吃完了！');
        }
        //点菜
        Customer.prototype.order = function () {
            let c = document.getElementById('menu');
            let name, price;
            let array = [];
            console.log('你看，你吃什么菜，我们这有红烧肉、小酥肉、蒸熊掌！');
            c.onclick = function (e) {
                let text = e.target.innerHTML;
                for (let i = 0; i < menuArray.length; i++) {
                    if (menuArray[i].name === text) {
                        price = menuArray[i].price;
                    }
                }
                console.log('好勒，您选了' + text + '  价格：' + price);
                array.push(text);
                let menu = waiter.work(array);
                let string = cook.work(menu);
                waiter.work(string);
            }


        }

        Customer.prototype.seat = function () {
            ifeRestaurant.seats--;
            console.log('顾客' + this.name + '入座了！');
            console.log('当前座位为：0');
        }
        Customer.prototype.leave = function () {
            console.log('顾客' + this.name + '走了！');
            customerArray.shift();
            ifeRestaurant.seats++;
        }

        //菜单
        function Menu(name, costing, price) {
            this.name = name;
            this.costing = costing;
            this.price = price;
        }
        Menu.prototype = {
            constructor: Menu,

        }
        //空对象作为中介
        function extend(Child, Parent) {
            let F = function () {};
            F.prototype = Parent.prototype;
            Child.prototype = new F();
            Child.prototype.constructor = Child;
        }

        //运行控制流程
        function init() {
            seatButton.onclick = function () {
                if (ifeRestaurant.seats === 19) {
                    console.log('抱歉，我们的座位满了，您看您等一等？');
                    return;
                }
                if (customerArray[0] === undefined) {
                    console.log('对不起，没有顾客了！');
                    return;
                }
                let cus = customerArray[0];
                cus.seat();
                cus.order();
            }

            leaveButton.onclick = function () {
                let cus = customerArray[0];
                cus.leave();

            }
            //菜名
            let dom = '';
            for (let i = 0; i < menuArray.length; i++) {
                dom += '<button>' + menuArray[i].name + '</button>';
            }
            let menuButton = document.createElement('div');
            menuButton.id = 'menu';
            menuButton.innerHTML = dom;
            document.getElementsByTagName('body')[0].appendChild(menuButton);

        }
        //构造实例

        let customerArray = [];
        let ifeRestaurant = new Restaurant({
            cash: 1000000,
            seats: 20,
            staff: []
        });


        let seatButton = document.getElementById('seat');
        let leaveButton = document.getElementById('leave');

        let Tom = new Customer('Tom');
        customerArray.push(Tom);
        let Tony = new Customer('Tony');
        customerArray.push(Tony);
        let Robin = new Customer('Robin');
        customerArray.push(Robin);

        let waiter = singletonWaiter.getInstance(1, '小张', 2000); //单例模式下的厨师和服务员
        ifeRestaurant.staff.push(waiter);
        let cook = singletonCook.getInstance(1, '张厨师', 5000);
        ifeRestaurant.staff.push(cook);
        
        //菜单
        let hongshaorou = new Menu('红烧肉', 20, 35);
        let xiaosurou = new Menu('小酥肉', 15, 30);
        let zhengxiongzhang = new Menu('蒸熊掌', 35, 59);
        let menuArray = [hongshaorou, xiaosurou, zhengxiongzhang];

        init();
    </script>
</body>

</html>